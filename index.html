<script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- 1. グローバル変数の準備（ここが重要！） ---
        let model = null; // モデルをどこからでも操作できるようにする箱
        const keys = {};  // 押されているキーを記憶する箱

        // 基本設定
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0); // 背景色（グレー）
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1, 5);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // ライト
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(1, 1, 1).normalize();
        scene.add(light);
        scene.add(new THREE.AmbientLight(0x404040));

        // マウス操作
        const controls = new OrbitControls(camera, renderer.domElement);

        // --- 2. モデルの読み込み ---
        const loader = new GLTFLoader();
        // ★ここにあなたの正しいファイル名を入れてください
        loader.load('models/MONSTER_ENERGIE.glb', (gltf) => { 
            model = gltf.scene; // 読み込んだモデルを「箱」に入れる
            scene.add(model);

            // サイズ調整（自動）
            const box = new THREE.Box3().setFromObject(model);
            const center = box.getCenter(new THREE.Vector3());
            const size = box.getSize(new THREE.Vector3());
            
            // 中心合わせ
            model.position.x += (model.position.x - center.x);
            model.position.y += (model.position.y - center.y);
            model.position.z += (model.position.z - center.z);

            // サイズ合わせ
            const maxDim = Math.max(size.x, size.y, size.z);
            const scale = 3 / maxDim;
            model.scale.set(scale, scale, scale);

        }, undefined, (error) => {
            console.error('エラー:', error);
        });

        // --- 3. キーボード入力の監視 ---
        document.addEventListener('keydown', (e) => keys[e.key] = true);
        document.addEventListener('keyup', (e) => keys[e.key] = false);

        // --- 4. アニメーションループ（毎フレーム実行される） ---
        function animate() {
            requestAnimationFrame(animate);

            // モデルが読み込み終わっていて、キーが押されていたら動かす
            if (model) {
                const speed = 0.1; // 移動スピード
                if (keys['w']) model.position.z -= speed; // 奥へ
                if (keys['s']) model.position.z += speed; // 手前へ
                if (keys['a']) model.position.x -= speed; // 左へ
                if (keys['d']) model.position.x += speed; // 右へ
                
                // おまけ：矢印キーなら回転させる
                if (keys['ArrowLeft']) model.rotation.y += 0.05;
                if (keys['ArrowRight']) model.rotation.y -= 0.05;
            }

            controls.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
