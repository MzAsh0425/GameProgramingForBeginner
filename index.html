<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>iPhone 17 Pro 3D Viewer</title>
    <style> body { margin: 0; overflow: hidden; } </style>
</head>
<body>
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.150.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.150.0/examples/jsm/"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- 1. グローバル変数の準備 ---
        let model = null; 
        const keys = {};  

        // 基本設定
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1, 5);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // ライト
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(1, 1, 1).normalize();
        scene.add(light);
        scene.add(new THREE.AmbientLight(0x404040));

        // マウス操作
        const controls = new OrbitControls(camera, renderer.domElement);

        // --- 2. モデルの読み込み ---
        const loader = new GLTFLoader();
        
        // ★★★注意：ここのファイル名をあなたのものに合わせてください！★★★
        loader.load('models/MONSTER_ENERGIE.glb', (gltf) => { 
            model = gltf.scene; 
            scene.add(model);

            // サイズ調整（自動）
            const box = new THREE.Box3().setFromObject(model);
            const center = box.getCenter(new THREE.Vector3());
            const size = box.getSize(new THREE.Vector3());
            
            // 中心合わせ
            model.position.x += (model.position.x - center.x);
            model.position.y += (model.position.y - center.y);
            model.position.z += (model.position.z - center.z);

            // サイズ合わせ
            const maxDim = Math.max(size.x, size.y, size.z);
            const scale = 3 / maxDim;
            model.scale.set(scale, scale, scale);

        }, undefined, (error) => {
            console.error('エラー:', error);
        });

        // --- 3. キーボード入力の監視 ---
        document.addEventListener('keydown', (e) => keys[e.key] = true);
        document.addEventListener('keyup', (e) => keys[e.key] = false);

        // --- 4. アニメーションループ ---
        function animate() {
            requestAnimationFrame(animate);

            if (model) {
                const speed = 0.1; 
                // W:奥, S:手前, A:左, D:右
                if (keys['w'] || keys['W']) model.position.z -= speed; 
                if (keys['s'] || keys['S']) model.position.z += speed; 
                if (keys['a'] || keys['A']) model.position.x -= speed; 
                if (keys['d'] || keys['D']) model.position.x += speed; 
                
                // 矢印キーで回転
                if (keys['ArrowLeft']) model.rotation.y += 0.05;
                if (keys['ArrowRight']) model.rotation.y -= 0.05;
            }

            controls.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
